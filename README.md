# Captioning UI

Фронтенд/бэкенд инструмент для разметки изображений и обрезки наборов данных под LoRA. Построен на FastAPI и Cropper.js.

## Установка

1. Склонируйте репозиторий и перейдите в каталог `captioning/`.
2. Запустите подготовку окружения:
   ```bat
   setup.bat
   ```
   Скрипт создаст виртуальное окружение и установит зависимости.

При необходимости вы также можете установить зависимости вручную:
```bash
pip install -r requirements.txt
```

## Запуск

```bat
run.bat
```

Сервер откроется на `http://127.0.0.1:8000/`. Веб‑интерфейс и API будут доступны сразу после старта.

## Возможности

- Работает с данными в `dataset/<имя>/train`, автоматически подхватывая изображения.
- Обрезка и изменение размеров без привязки к сетке 64×64; приложение само рассчитывает metadata.
- При сохранении генерирует корректные записи `train_resolution` (кратные 64 для sd-scripts) и реальные размеры изображения.
- Поддерживает различные режимы расширения холста, центрирование, подсказки по словам и экспорт `metadata.json`.
- Защита от перезаписи посторонних файлов и нормализация путей.

## Формат метаданных

Каждый элемент в `metadata.json` описывается JSON-объектом, где ключ – путь вида `dataset/<имя>/train/<файл>`, а значения включают `caption`, `train_resolution` и фактическое разрешение изображения.

## Горячие клавиши UI

- Навигация по предложениям: `Ctrl/⌘ + ↑/↓`, подтверждение через `Enter` или `Tab`.
- Кнопка «Обрезать» применяет текущую рамку, расширение создаёт нужный холст без ручного пересчёта.
- В разделе списка видно, какие изображения подписаны, а какие ещё требуют внимания.

---

Весь код в этом репозитории сгенерирован OpenAI Codex GPT-5.
