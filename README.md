# Captioning UI

Инструмент для разметки датасетов и обрезки изображений под обучение LoRA. Работает локально, использует FastAPI и Cropper.js.

## Установка

1. Перейдите в папку проекта `captioning/`.
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

## Запуск

```bash
python app.py
```

Сервис поднимется на `http://127.0.0.1:8000/`. Статика доступна сразу, API обслуживает ту же страницу.

## Возможности

- Сканирование папки `dataset/<имя>/train` (включая вложенные каталоги) и отображение изображений.
- Просмотр изображения и обрезка с защёлкой по сетке 64?64, кнопки центрирования и сброса.
- Кнопка «Применить обрезку при сохранении» выполняет физическое сохранение обновлённого файла и обновляет `train_resolution`.
- Кнопка «Сжать» уменьшает изображение так, чтобы обе стороны не превышали выбранное значение (по умолчанию 1024 px, шаг 64).
- Цветной индикатор в списке показывает, есть ли подпись у изображения.
- Поле подписей с автодополнением по словам из текущего датасета и глобального словаря (берётся из уже подготовленных `metadata.json`).
- Фильтрация списка по имени файла или тегу.
- Экспорт текущей разметки (`metadata.json`) одной кнопкой.

## Формат данных

Экспортируемый JSON совместим с уже существующими `metadata.json`: ключ — относительный путь `dataset/<имя>/train/<файл>`, значение — словарь `caption` и `train_resolution` (высота, ширина).

## Советы по работе

- Для быстрого заполнения тегов используйте стрелки `^/v`, `Enter` или `Tab` — они вставляют выбранное предложение.
- Чекбокс «Применить обрезку при сохранении» перезаписывает файл кадрированным вариантом; без галочки изменения остаются только в подписях.
- Зелёная точка слева от имени означает, что у кадра уже есть подпись; жёлтая — пометка о необходимости разметки.
- Перед сохранением можно принудительно округлить область выделения кнопкой «Привести к ?64».
- После обрезки или сжатия изображение перезагружается автоматически, чтобы показать итоговый размер.

